import cv2
import numpy as np


class HandShape:
    def __init__(self, shape, msg):
        self.shape = shape
        self.msg = msg
        self.count = 0

    def reset_count(self):
        self.count = 0

    def inc_count(self):
        self.count += 1

    def bestMatch(self, c):
        res = 10
        for s in self.shape:
            tmp = cv2.matchShapes(s, c, 1, 0.0)
            if tmp < res:
                res = tmp
        return res

show_detailed = False
color_keying = False
use_hull = True
five_fingers =  [ np.matrix([[74, 0], [73, 1], [72, 1], [71, 2], [70, 2], [70, 4], [69, 5], [68, 5], [68, 8], [67, 9], [66, 9], [66, 10], [68, 12], [68, 20], [69, 20], [70, 21], [70, 22], [69, 23], [68, 22], [68, 25], [69, 24], [70, 25], [70, 32], [69, 33], [70, 34], [70, 39], [69, 40], [70, 41], [70, 51], [69, 52], [68, 52], [68, 62], [69, 62], [70, 63], [69, 64], [68, 64], [68, 66], [69, 67], [68, 68], [68, 85], [67, 86], [68, 87], [68, 91], [67, 92], [68, 93], [68, 95], [67, 96], [67, 97], [66, 98], [65, 98], [65, 99], [64, 100], [63, 99], [63, 98], [62, 98], [61, 97], [61, 94], [63, 92], [62, 92], [61, 91], [61, 85], [60, 86], [59, 85], [59, 78], [58, 79], [57, 78], [57, 76], [58, 75], [59, 75], [59, 74], [56, 74], [55, 73], [57, 71], [57, 68], [56, 67], [56, 63], [55, 62], [55, 60], [54, 60], [53, 59], [54, 58], [55, 58], [54, 58], [53, 57], [53, 48], [52, 48], [51, 47], [51, 42], [52, 41], [51, 40], [51, 37], [49, 35], [49, 33], [50, 32], [51, 33], [51, 32], [49, 30], [49, 26], [48, 25], [49, 24], [48, 24], [47, 23], [47, 20], [46, 19], [44, 19], [43, 18], [43, 17], [42, 18], [41, 17], [36, 17], [35, 18], [34, 18], [30, 22], [30, 23], [28, 25], [28, 32], [29, 33], [28, 34], [28, 36], [29, 37], [29, 42], [28, 43], [28, 44], [29, 44], [30, 45], [30, 48], [31, 49], [30, 50], [30, 51], [32, 53], [32, 54], [31, 55], [32, 56], [33, 56], [34, 57], [33, 58], [32, 58], [33, 58], [34, 59], [33, 60], [34, 61], [34, 72], [35, 72], [36, 73], [35, 74], [34, 74], [34, 75], [35, 75], [36, 76], [36, 77], [35, 78], [34, 77], [34, 78], [35, 78], [36, 79], [36, 82], [37, 82], [38, 83], [38, 85], [37, 86], [37, 88], [36, 89], [37, 89], [38, 90], [38, 94], [40, 96], [39, 97], [38, 97], [38, 98], [39, 98], [40, 99], [40, 105], [41, 105], [42, 106], [42, 114], [41, 115], [38, 115], [37, 114], [37, 112], [36, 112], [35, 111], [35, 110], [34, 109], [35, 108], [34, 109], [33, 108], [33, 106], [32, 106], [31, 105], [30, 105], [29, 104], [30, 103], [28, 101], [28, 99], [27, 98], [27, 92], [26, 92], [25, 91], [25, 87], [23, 85], [23, 77], [23, 78], [22, 79], [21, 78], [21, 69], [19, 67], [19, 64], [18, 63], [18, 61], [16, 59], [16, 58], [15, 57], [15, 55], [13, 53], [11, 53], [9, 51], [8, 51], [7, 52], [5, 52], [4, 53], [3, 53], [4, 54], [2, 56], [2, 57], [1, 58], [1, 60], [0, 61], [0, 64], [1, 65], [0, 66], [1, 67], [1, 68], [2, 69], [0, 71], [0, 72], [2, 74], [2, 78], [3, 79], [2, 80], [4, 82], [4, 86], [5, 87], [5, 89], [6, 90], [6, 93], [7, 94], [7, 98], [8, 99], [8, 101], [9, 102], [9, 104], [10, 105], [10, 108], [12, 110], [11, 111], [12, 112], [12, 113], [16, 117], [15, 118], [16, 119], [16, 125], [17, 125], [18, 126], [18, 132], [19, 132], [20, 133], [20, 134], [19, 135], [18, 135], [19, 135], [20, 136], [20, 142], [21, 142], [22, 143], [22, 162], [23, 162], [24, 163], [23, 164], [22, 164], [22, 166], [23, 166], [24, 167], [24, 168], [23, 169], [22, 169], [22, 172], [23, 172], [24, 173], [24, 190], [25, 191], [25, 192], [26, 193], [26, 196], [27, 196], [28, 197], [28, 202], [29, 203], [29, 205], [30, 206], [30, 208], [31, 209], [30, 210], [30, 211], [31, 212], [31, 213], [32, 214], [31, 215], [31, 217], [32, 218], [32, 219], [31, 220], [31, 222], [32, 223], [32, 225], [31, 226], [32, 227], [32, 228], [31, 229], [31, 235], [30, 236], [30, 240], [29, 241], [28, 241], [29, 241], [30, 242], [30, 243], [29, 244], [29, 246], [28, 247], [28, 250], [100, 250], [100, 249], [102, 247], [102, 246], [103, 245], [103, 241], [104, 240], [105, 240], [105, 238], [104, 238], [103, 237], [106, 234], [105, 233], [106, 232], [107, 232], [109, 230], [109, 229], [110, 228], [113, 228], [114, 227], [113, 226], [114, 225], [116, 225], [117, 226], [117, 225], [118, 224], [119, 224], [119, 223], [121, 221], [122, 222], [124, 220], [125, 220], [127, 218], [127, 217], [128, 216], [130, 216], [132, 214], [133, 214], [133, 213], [137, 209], [138, 210], [139, 210], [139, 209], [142, 206], [141, 205], [142, 204], [144, 204], [145, 205], [145, 203], [146, 202], [147, 202], [147, 201], [148, 200], [151, 200], [151, 197], [153, 195], [155, 195], [157, 193], [157, 192], [158, 191], [158, 190], [159, 189], [161, 189], [161, 188], [163, 186], [165, 186], [165, 185], [166, 184], [167, 184], [167, 182], [168, 181], [168, 180], [169, 179], [170, 179], [171, 178], [171, 177], [172, 176], [173, 176], [173, 174], [175, 172], [175, 171], [177, 169], [178, 169], [178, 168], [179, 167], [180, 168], [180, 166], [179, 165], [180, 164], [183, 164], [183, 163], [186, 160], [187, 160], [189, 158], [190, 158], [191, 157], [191, 155], [192, 154], [195, 154], [195, 152], [197, 150], [197, 149], [198, 148], [198, 147], [199, 146], [200, 147], [201, 147], [201, 146], [202, 145], [202, 144], [203, 143], [204, 143], [203, 142], [203, 141], [208, 136], [210, 136], [211, 135], [211, 134], [212, 133], [213, 133], [215, 131], [215, 125], [214, 125], [213, 124], [213, 123], [212, 122], [211, 123], [209, 121], [208, 121], [207, 120], [204, 120], [203, 119], [203, 118], [202, 118], [201, 119], [196, 119], [195, 120], [192, 120], [192, 121], [191, 122], [188, 122], [187, 123], [186, 123], [185, 124], [182, 124], [182, 126], [181, 127], [180, 127], [179, 128], [178, 127], [178, 126], [178, 128], [177, 129], [176, 129], [176, 131], [175, 132], [172, 132], [172, 134], [171, 135], [170, 135], [170, 137], [169, 138], [168, 138], [168, 139], [167, 140], [164, 140], [164, 141], [163, 142], [162, 142], [148, 156], [145, 156], [144, 157], [143, 156], [143, 155], [140, 155], [139, 156], [138, 156], [137, 155], [135, 155], [133, 153], [132, 153], [130, 151], [129, 151], [128, 150], [128, 149], [127, 148], [127, 146], [126, 145], [126, 144], [125, 143], [125, 141], [126, 140], [126, 139], [125, 138], [125, 137], [123, 135], [123, 134], [124, 133], [125, 133], [125, 131], [126, 130], [127, 130], [126, 130], [125, 129], [124, 129], [123, 128], [123, 123], [124, 122], [125, 122], [125, 121], [124, 122], [123, 121], [123, 120], [124, 119], [125, 119], [125, 98], [126, 97], [125, 96], [125, 95], [126, 94], [126, 93], [127, 92], [127, 80], [128, 79], [129, 80], [129, 73], [130, 72], [130, 71], [129, 70], [129, 64], [130, 63], [131, 63], [131, 50], [130, 50], [129, 49], [130, 48], [131, 48], [131, 44], [132, 43], [131, 42], [131, 40], [130, 41], [129, 40], [129, 39], [130, 38], [131, 38], [131, 30], [130, 31], [129, 30], [129, 28], [131, 26], [131, 24], [129, 22], [129, 18], [128, 18], [127, 17], [127, 13], [126, 13], [125, 12], [125, 10], [122, 10], [121, 9], [118, 9], [117, 8], [117, 7], [116, 7], [117, 8], [116, 9], [112, 9], [109, 12], [108, 12], [108, 13], [107, 14], [106, 14], [106, 15], [107, 14], [108, 15], [108, 21], [107, 22], [106, 22], [106, 24], [107, 24], [108, 25], [107, 26], [106, 26], [106, 32], [105, 33], [106, 34], [106, 37], [105, 38], [106, 39], [106, 46], [107, 46], [108, 47], [108, 49], [107, 50], [106, 50], [106, 60], [105, 61], [104, 61], [104, 65], [103, 66], [102, 66], [102, 76], [101, 77], [100, 77], [100, 86], [98, 88], [98, 94], [97, 95], [96, 95], [96, 96], [95, 97], [92, 97], [91, 96], [92, 95], [91, 94], [91, 91], [93, 89], [92, 89], [91, 88], [92, 87], [92, 86], [91, 85], [91, 83], [92, 82], [93, 82], [93, 76], [92, 76], [91, 75], [91, 73], [92, 72], [93, 72], [93, 71], [91, 69], [91, 68], [93, 66], [93, 62], [92, 62], [91, 61], [91, 59], [92, 58], [93, 58], [93, 56], [94, 55], [95, 55], [94, 55], [93, 54], [93, 53], [91, 51], [92, 50], [92, 48], [91, 47], [91, 42], [92, 41], [93, 41], [91, 39], [91, 33], [92, 32], [92, 30], [91, 29], [91, 22], [90, 21], [90, 20], [91, 19], [91, 15], [90, 14], [91, 13], [91, 12], [90, 12], [89, 11], [89, 9], [88, 8], [88, 7], [87, 6], [87, 3], [85, 3], [83, 1], [76, 1], [75, 0]])
                , np.matrix([[43,0],[42,1],[41,1],[41,4],[39,6],[38,5],[37,5],[37,6],[38,6],[39,7],[39,15],[40,16],[39,17],[39,18],[38,19],[39,20],[39,22],[41,24],[41,25],[40,26],[41,27],[40,28],[39,28],[39,31],[41,33],[39,35],[40,35],[41,36],[41,39],[42,40],[41,41],[42,41],[43,42],[42,43],[43,44],[43,47],[44,48],[44,50],[45,51],[43,53],[42,52],[41,52],[40,51],[40,50],[38,48],[38,44],[39,43],[37,43],[34,40],[36,38],[37,38],[36,38],[35,37],[36,36],[36,34],[35,34],[34,33],[34,29],[33,29],[32,28],[33,27],[34,27],[34,26],[33,26],[32,25],[32,23],[31,22],[31,20],[27,20],[26,19],[26,18],[26,19],[25,20],[23,20],[23,21],[22,22],[21,22],[20,23],[19,23],[19,31],[20,32],[20,35],[19,36],[19,38],[20,39],[20,40],[23,43],[23,46],[24,47],[24,51],[25,52],[25,55],[26,56],[26,57],[27,58],[26,59],[25,59],[26,59],[27,60],[27,63],[28,64],[27,65],[28,65],[29,66],[29,67],[30,68],[30,69],[29,70],[30,70],[31,71],[31,78],[29,80],[28,80],[27,79],[27,78],[26,77],[26,76],[25,75],[25,74],[23,72],[23,71],[18,66],[18,64],[16,62],[16,60],[14,58],[14,56],[13,56],[12,55],[12,53],[11,53],[10,52],[10,51],[9,51],[7,49],[5,49],[5,50],[4,51],[2,51],[2,53],[1,54],[1,56],[0,57],[0,59],[1,60],[1,64],[2,64],[4,66],[4,67],[5,68],[5,69],[6,70],[5,71],[5,72],[6,72],[8,74],[7,75],[8,75],[9,76],[9,77],[10,78],[9,79],[9,80],[10,80],[12,82],[12,83],[13,84],[13,85],[14,85],[16,87],[16,88],[15,89],[14,89],[17,89],[18,90],[18,93],[17,94],[17,96],[16,97],[16,98],[17,99],[17,101],[18,101],[19,102],[19,103],[18,104],[17,103],[18,104],[19,103],[20,104],[20,106],[19,107],[19,109],[20,108],[21,109],[21,110],[20,111],[21,111],[22,112],[21,113],[22,114],[22,116],[21,117],[22,118],[23,118],[25,120],[25,124],[26,124],[27,125],[27,127],[28,128],[27,129],[30,132],[29,133],[31,135],[32,135],[33,136],[33,137],[32,138],[31,138],[32,138],[36,142],[36,143],[35,144],[35,145],[36,146],[36,147],[37,146],[38,147],[38,149],[37,150],[37,151],[39,153],[39,154],[41,156],[41,157],[40,158],[43,161],[43,168],[44,168],[45,169],[43,171],[43,174],[42,175],[41,175],[41,176],[42,176],[43,177],[43,178],[42,179],[41,179],[41,182],[42,183],[42,184],[41,185],[41,191],[40,192],[40,195],[39,196],[39,200],[38,201],[37,201],[37,202],[38,202],[39,203],[38,204],[37,204],[37,218],[36,219],[35,219],[35,227],[94,227],[94,217],[93,216],[94,215],[94,212],[95,211],[94,210],[94,205],[93,204],[93,202],[94,201],[95,201],[96,200],[95,199],[95,197],[94,197],[93,196],[93,194],[94,193],[95,193],[95,189],[94,190],[93,189],[93,188],[94,187],[95,187],[95,185],[94,186],[93,185],[93,178],[92,177],[92,172],[93,171],[94,171],[94,158],[95,157],[94,156],[94,146],[95,145],[97,145],[98,144],[97,143],[97,142],[98,141],[98,138],[97,137],[97,135],[99,133],[99,131],[102,128],[102,127],[103,126],[104,127],[103,126],[103,125],[105,123],[105,121],[106,120],[107,120],[108,121],[108,122],[107,123],[108,122],[108,121],[109,120],[109,119],[110,118],[111,118],[111,117],[114,114],[113,114],[112,113],[112,112],[113,111],[115,111],[117,109],[118,109],[117,108],[118,107],[117,107],[116,106],[117,105],[118,105],[118,103],[117,103],[116,102],[117,101],[117,100],[118,99],[118,96],[119,95],[120,95],[120,93],[119,92],[120,91],[120,89],[121,88],[122,88],[122,83],[123,82],[124,82],[125,81],[124,80],[124,78],[126,76],[126,70],[129,67],[130,67],[130,65],[132,63],[132,62],[131,62],[130,61],[133,58],[135,58],[134,57],[134,55],[133,55],[132,54],[132,53],[131,53],[130,52],[129,52],[127,50],[127,51],[126,52],[123,52],[122,51],[123,52],[122,53],[121,53],[118,56],[117,56],[114,59],[113,59],[109,63],[109,64],[107,66],[107,67],[106,68],[106,71],[105,72],[105,74],[104,75],[104,77],[103,78],[102,78],[102,79],[101,80],[101,82],[100,83],[100,84],[99,85],[99,86],[98,87],[96,87],[94,85],[94,84],[92,82],[92,81],[90,79],[90,77],[88,75],[88,67],[87,66],[87,63],[86,62],[87,61],[87,59],[86,58],[87,57],[87,51],[86,50],[87,49],[87,37],[86,36],[87,35],[87,33],[86,32],[86,30],[85,30],[84,29],[84,27],[85,26],[86,27],[86,25],[85,26],[84,25],[84,21],[85,20],[83,20],[82,19],[82,17],[84,15],[83,15],[82,14],[82,10],[81,11],[80,10],[80,5],[78,3],[78,0],[71,0],[70,1],[69,1],[69,2],[68,3],[67,3],[67,5],[66,6],[65,6],[64,5],[64,4],[64,5],[65,6],[65,8],[66,9],[66,10],[67,11],[66,12],[66,15],[67,16],[67,18],[66,19],[67,20],[67,24],[68,25],[67,26],[67,39],[68,40],[67,41],[67,44],[66,45],[67,46],[67,47],[66,48],[67,49],[67,50],[66,51],[65,51],[64,50],[63,50],[61,48],[61,46],[60,45],[60,38],[59,38],[58,37],[58,36],[59,35],[60,35],[59,35],[58,34],[58,29],[57,29],[56,28],[56,25],[55,24],[56,23],[55,23],[54,22],[54,19],[53,18],[54,17],[54,10],[53,9],[53,8],[52,7],[52,1],[49,1],[48,0]])
                , np.matrix([[68,0],[65,3],[64,3],[63,2],[63,3],[62,4],[62,6],[61,7],[60,7],[60,12],[61,13],[60,14],[60,15],[62,17],[61,18],[60,18],[60,26],[61,27],[60,28],[60,32],[61,32],[62,33],[62,48],[61,49],[62,50],[61,51],[63,51],[64,52],[64,53],[63,54],[62,54],[62,58],[61,59],[61,60],[60,61],[61,61],[62,62],[62,65],[63,64],[64,65],[64,74],[65,75],[64,76],[66,78],[66,85],[68,87],[68,88],[67,89],[65,89],[64,88],[63,88],[64,88],[65,89],[64,90],[62,90],[61,89],[61,78],[60,78],[59,77],[59,74],[58,73],[59,72],[58,72],[57,71],[57,70],[56,69],[56,68],[55,67],[55,62],[54,62],[53,61],[53,57],[51,55],[51,49],[50,48],[50,47],[51,46],[51,44],[50,44],[49,43],[49,38],[47,36],[47,26],[46,26],[44,24],[42,24],[41,23],[41,22],[38,22],[37,23],[36,23],[35,24],[33,24],[32,25],[30,25],[31,25],[32,26],[32,27],[30,29],[28,29],[28,32],[29,33],[28,34],[30,36],[30,48],[31,49],[30,50],[30,51],[31,51],[32,52],[32,55],[33,55],[34,56],[34,67],[36,69],[36,78],[37,78],[38,79],[38,86],[39,86],[40,87],[40,88],[42,90],[41,91],[40,91],[42,93],[42,97],[43,98],[42,99],[43,99],[44,100],[44,110],[43,111],[41,111],[40,110],[39,110],[38,109],[37,109],[36,108],[36,107],[34,105],[34,104],[35,103],[35,102],[33,100],[33,99],[31,97],[31,95],[29,93],[29,91],[28,91],[27,90],[28,89],[27,88],[26,88],[25,87],[25,85],[24,85],[23,84],[24,83],[23,82],[23,79],[22,79],[21,78],[21,76],[20,76],[19,75],[19,69],[18,69],[17,68],[16,68],[15,67],[15,66],[16,65],[15,64],[15,63],[14,63],[13,62],[13,61],[10,61],[9,60],[9,59],[5,59],[8,59],[9,60],[8,61],[5,61],[4,62],[3,61],[2,61],[2,64],[1,65],[0,65],[0,73],[1,73],[2,74],[2,76],[3,77],[2,78],[2,79],[3,79],[4,80],[4,86],[5,86],[6,87],[6,88],[7,88],[8,89],[8,94],[9,94],[10,95],[10,98],[11,98],[12,99],[12,102],[13,103],[13,104],[14,105],[14,107],[15,107],[16,108],[16,111],[17,111],[18,112],[18,114],[19,114],[20,115],[20,116],[21,116],[22,117],[22,119],[21,120],[22,119],[23,119],[24,120],[24,133],[25,132],[26,133],[26,141],[27,141],[28,142],[28,144],[29,144],[30,145],[30,146],[29,147],[28,147],[29,147],[30,148],[30,150],[31,150],[32,151],[32,156],[33,156],[34,157],[34,158],[33,159],[32,159],[32,161],[33,161],[34,162],[34,163],[35,163],[36,164],[36,169],[37,170],[37,171],[38,172],[38,173],[39,174],[39,175],[40,176],[40,178],[41,179],[41,180],[42,181],[42,182],[43,183],[43,184],[44,185],[44,187],[45,188],[45,189],[46,190],[46,191],[47,192],[47,193],[46,194],[46,195],[48,195],[49,196],[49,197],[50,198],[49,199],[48,199],[49,200],[50,200],[51,201],[51,204],[50,205],[50,206],[52,206],[53,207],[53,211],[52,212],[53,213],[52,214],[54,214],[55,215],[55,216],[53,218],[54,218],[55,219],[55,220],[56,221],[56,225],[57,226],[57,229],[56,230],[56,232],[57,232],[58,233],[58,243],[57,244],[56,244],[55,243],[56,242],[56,240],[56,242],[55,243],[57,245],[57,248],[56,249],[56,256],[55,257],[54,257],[54,258],[55,257],[56,258],[56,263],[55,264],[54,263],[54,264],[55,264],[56,265],[55,266],[55,270],[54,271],[53,270],[54,271],[54,272],[53,273],[53,274],[54,274],[55,275],[54,276],[54,281],[53,282],[52,282],[53,283],[52,284],[52,286],[53,287],[53,290],[52,291],[51,291],[51,296],[52,297],[52,298],[51,299],[52,300],[51,301],[50,301],[50,306],[49,307],[50,308],[51,308],[52,309],[52,312],[51,313],[51,315],[52,316],[51,317],[50,317],[50,318],[51,319],[51,321],[50,322],[50,324],[49,325],[49,326],[50,327],[50,329],[49,330],[49,331],[48,332],[48,354],[47,355],[46,354],[46,355],[45,356],[47,356],[48,357],[48,360],[65,360],[65,359],[67,357],[67,356],[66,355],[67,354],[69,354],[68,353],[67,354],[66,353],[66,352],[67,351],[69,351],[71,349],[71,348],[73,346],[74,347],[75,347],[76,348],[75,349],[74,349],[73,350],[74,351],[74,352],[75,353],[74,354],[74,355],[73,356],[72,355],[72,356],[75,356],[76,357],[76,358],[75,359],[74,358],[73,359],[72,359],[72,360],[73,359],[76,359],[77,358],[78,359],[78,360],[79,359],[80,360],[129,360],[130,359],[131,360],[131,359],[132,358],[132,356],[133,355],[132,354],[130,354],[128,352],[129,351],[129,350],[130,349],[131,350],[131,351],[132,351],[131,350],[132,349],[131,350],[130,349],[130,346],[129,346],[128,345],[129,344],[129,342],[130,341],[129,340],[129,338],[128,338],[127,337],[128,336],[129,336],[130,335],[129,334],[129,330],[128,331],[127,330],[127,328],[128,327],[128,322],[127,321],[128,320],[128,319],[127,320],[126,320],[125,319],[125,318],[126,317],[127,317],[127,316],[128,315],[129,315],[128,315],[126,317],[125,316],[125,312],[127,310],[127,306],[128,305],[128,303],[127,302],[127,300],[126,299],[126,298],[125,297],[126,296],[126,295],[127,294],[128,295],[126,293],[127,292],[126,291],[126,290],[125,290],[124,289],[125,288],[127,288],[126,287],[126,286],[125,285],[126,284],[127,284],[126,283],[126,282],[125,281],[125,278],[126,277],[125,276],[125,272],[126,271],[126,264],[127,263],[127,262],[126,261],[126,259],[125,258],[125,257],[124,256],[125,255],[125,254],[126,253],[125,252],[126,251],[125,252],[124,251],[124,250],[125,249],[125,247],[126,246],[125,245],[125,242],[126,241],[127,241],[126,240],[127,239],[126,238],[126,237],[125,236],[125,235],[126,234],[126,232],[127,231],[128,232],[128,231],[127,231],[126,230],[126,229],[127,228],[126,227],[126,225],[127,224],[128,224],[129,223],[128,223],[127,222],[127,217],[128,216],[127,216],[126,215],[126,214],[127,213],[129,213],[129,212],[128,211],[129,210],[129,207],[131,205],[130,205],[129,204],[129,203],[130,202],[132,202],[133,201],[133,199],[135,197],[134,198],[133,197],[133,196],[134,195],[135,195],[135,194],[136,193],[137,194],[138,194],[137,194],[136,193],[137,192],[137,191],[140,188],[141,189],[142,188],[143,188],[143,187],[142,186],[142,185],[143,184],[144,184],[145,183],[146,184],[145,183],[147,181],[147,180],[146,179],[147,178],[147,177],[148,176],[150,178],[148,176],[148,175],[149,174],[149,173],[150,172],[151,172],[151,171],[153,169],[153,168],[154,167],[155,167],[155,166],[156,165],[156,164],[159,161],[159,160],[161,158],[161,157],[162,156],[163,156],[164,157],[163,156],[163,154],[164,153],[165,153],[166,152],[165,151],[165,148],[166,147],[167,147],[167,144],[166,144],[165,143],[165,142],[166,141],[167,141],[167,135],[168,134],[168,133],[167,132],[167,129],[168,128],[169,128],[169,119],[170,118],[171,118],[171,115],[172,114],[173,114],[173,113],[175,111],[175,106],[176,105],[175,104],[175,101],[176,100],[177,100],[177,96],[178,95],[179,95],[179,91],[180,90],[181,91],[181,83],[180,83],[179,82],[178,82],[177,81],[176,82],[175,81],[171,81],[170,82],[167,82],[166,83],[165,82],[161,86],[160,85],[160,87],[161,88],[160,89],[158,89],[155,92],[152,92],[153,93],[152,94],[152,97],[154,99],[153,100],[152,100],[151,101],[150,101],[148,99],[149,100],[148,101],[149,101],[150,102],[148,104],[148,106],[147,107],[146,107],[145,106],[146,107],[149,107],[150,108],[150,109],[151,110],[149,112],[147,112],[146,111],[148,113],[148,115],[149,116],[147,118],[146,117],[146,118],[147,118],[148,117],[150,119],[148,121],[147,120],[146,121],[145,120],[144,120],[144,121],[143,122],[142,122],[140,124],[140,125],[139,126],[140,127],[138,129],[139,129],[140,130],[139,131],[137,131],[136,132],[135,131],[134,131],[133,130],[133,129],[132,128],[133,127],[133,124],[132,124],[131,123],[131,121],[130,121],[129,120],[129,119],[128,119],[127,118],[127,112],[126,112],[125,111],[124,111],[123,110],[123,100],[122,101],[121,100],[121,91],[122,90],[121,89],[121,85],[122,84],[122,81],[123,80],[122,80],[121,79],[121,78],[122,77],[121,76],[121,74],[122,73],[121,72],[121,53],[122,52],[123,52],[124,53],[122,51],[122,50],[121,49],[121,48],[120,48],[119,47],[119,39],[118,39],[117,38],[117,29],[119,27],[118,27],[117,26],[117,24],[116,24],[115,23],[115,13],[114,13],[113,12],[113,8],[112,8],[111,7],[111,6],[110,6],[109,5],[109,4],[108,4],[107,3],[104,3],[105,3],[106,4],[105,5],[101,5],[100,6],[98,6],[97,7],[96,7],[96,8],[95,9],[94,9],[94,10],[93,11],[92,11],[93,11],[94,12],[94,15],[93,16],[94,17],[93,18],[92,18],[93,18],[94,19],[94,29],[93,30],[92,30],[93,30],[94,31],[94,35],[95,36],[94,37],[94,44],[95,44],[96,45],[95,46],[94,46],[94,49],[95,48],[96,49],[96,50],[95,51],[94,51],[95,51],[96,52],[96,54],[95,55],[94,55],[94,56],[95,56],[96,57],[96,58],[95,59],[94,59],[94,61],[93,62],[94,61],[96,63],[96,64],[95,65],[94,65],[94,71],[95,71],[96,72],[96,74],[95,75],[94,75],[94,78],[95,78],[96,79],[95,80],[96,81],[96,82],[95,83],[94,83],[94,85],[93,86],[90,86],[89,85],[89,84],[88,84],[87,83],[89,81],[89,80],[88,79],[88,78],[89,77],[87,75],[87,72],[86,71],[87,70],[87,62],[86,61],[86,59],[87,58],[87,57],[89,55],[87,53],[87,52],[86,52],[85,51],[85,44],[83,42],[83,37],[84,36],[83,35],[84,34],[84,31],[83,32],[82,31],[82,30],[81,29],[81,27],[82,26],[82,23],[81,22],[81,14],[80,13],[81,12],[81,11],[80,10],[81,9],[81,7],[80,7],[79,6],[79,3],[78,3],[76,1],[74,1],[73,0]])
                ]
fist_with_finger =  [ np.matrix([[96, 0], [96, 1], [95, 2], [93, 2], [92, 3], [92, 4], [91, 5], [88, 5], [89, 6], [89, 7], [88, 8], [87, 7], [85, 7], [83, 5], [72, 5], [72, 6], [69, 9], [68, 9], [67, 10], [67, 11], [65, 13], [64, 13], [63, 12], [62, 12], [61, 11], [61, 10], [55, 10], [53, 12], [49, 12], [48, 13], [47, 13], [46, 14], [46, 15], [43, 18], [43, 19], [41, 21], [40, 21], [39, 20], [38, 20], [37, 21], [36, 20], [32, 20], [31, 21], [30, 21], [29, 22], [28, 22], [27, 23], [25, 23], [25, 24], [24, 25], [24, 26], [23, 27], [22, 27], [21, 28], [20, 28], [20, 29], [18, 31], [18, 33], [17, 34], [16, 34], [16, 40], [14, 42], [14, 44], [13, 45], [13, 47], [11, 49], [12, 50], [12, 57], [11, 58], [11, 59], [10, 60], [10, 61], [11, 62], [11, 70], [10, 71], [10, 72], [11, 73], [10, 74], [10, 75], [9, 76], [10, 77], [10, 78], [9, 79], [8, 79], [10, 81], [9, 82], [10, 83], [10, 85], [9, 86], [10, 87], [10, 93], [11, 93], [12, 94], [12, 95], [11, 96], [11, 97], [12, 96], [13, 97], [13, 100], [12, 101], [12, 102], [13, 101], [14, 102], [14, 103], [13, 104], [12, 104], [12, 107], [12, 105], [13, 104], [14, 105], [14, 108], [15, 109], [15, 115], [14, 116], [15, 117], [15, 144], [14, 145], [13, 144], [12, 144], [12, 146], [13, 145], [14, 146], [14, 147], [13, 148], [13, 150], [12, 151], [13, 152], [12, 153], [12, 158], [11, 159], [11, 163], [9, 165], [8, 165], [9, 165], [10, 166], [10, 167], [9, 168], [9, 172], [6, 175], [6, 177], [5, 178], [6, 178], [7, 179], [7, 181], [6, 182], [6, 184], [4, 186], [4, 191], [3, 192], [2, 191], [2, 199], [1, 200], [0, 199], [0, 200], [73, 200], [73, 198], [74, 197], [75, 197], [74, 196], [74, 192], [75, 191], [75, 187], [74, 186], [74, 184], [75, 183], [76, 184], [76, 183], [77, 182], [77, 176], [76, 175], [76, 174], [77, 173], [77, 168], [78, 167], [79, 168], [79, 171], [79, 168], [80, 167], [78, 165], [79, 164], [81, 164], [81, 163], [80, 162], [79, 162], [78, 161], [81, 158], [81, 155], [83, 153], [83, 150], [82, 150], [81, 149], [82, 148], [83, 148], [83, 145], [84, 144], [84, 142], [85, 141], [85, 139], [87, 137], [87, 133], [88, 132], [88, 131], [90, 129], [91, 129], [91, 126], [92, 125], [92, 124], [93, 123], [94, 124], [94, 125], [95, 124], [95, 121], [96, 120], [97, 120], [98, 121], [100, 119], [103, 119], [105, 117], [107, 117], [107, 115], [108, 114], [109, 114], [110, 115], [111, 115], [111, 114], [112, 113], [113, 113], [116, 110], [115, 109], [116, 108], [118, 108], [120, 106], [121, 106], [121, 105], [122, 104], [123, 105], [123, 104], [124, 103], [125, 103], [130, 98], [131, 98], [132, 97], [133, 97], [134, 96], [135, 96], [135, 95], [136, 94], [137, 94], [137, 93], [138, 92], [140, 92], [141, 91], [143, 91], [143, 89], [144, 88], [145, 89], [145, 88], [147, 86], [149, 86], [149, 84], [150, 83], [151, 83], [152, 82], [153, 82], [153, 81], [154, 80], [155, 80], [155, 79], [157, 77], [157, 76], [158, 75], [159, 75], [160, 74], [161, 74], [160, 74], [159, 75], [158, 74], [158, 73], [159, 72], [160, 72], [159, 71], [161, 69], [162, 69], [161, 68], [162, 67], [163, 67], [164, 66], [165, 66], [165, 64], [164, 64], [163, 63], [163, 62], [164, 61], [165, 61], [166, 62], [167, 62], [167, 61], [166, 60], [167, 59], [171, 59], [171, 58], [172, 57], [173, 57], [173, 56], [174, 55], [177, 55], [177, 53], [178, 52], [179, 52], [179, 50], [180, 49], [181, 49], [181, 47], [182, 46], [183, 46], [182, 46], [181, 45], [181, 42], [182, 41], [185, 41], [186, 40], [187, 40], [187, 39], [188, 38], [189, 38], [190, 37], [191, 37], [191, 36], [192, 35], [195, 35], [198, 32], [199, 33], [199, 32], [200, 31], [202, 31], [203, 30], [202, 30], [201, 29], [202, 28], [203, 28], [203, 27], [201, 25], [200, 25], [199, 24], [198, 24], [197, 23], [197, 22], [196, 23], [194, 23], [193, 22], [183, 22], [182, 23], [181, 23], [180, 24], [179, 23], [178, 23], [177, 24], [175, 24], [171, 28], [169, 28], [167, 30], [166, 30], [166, 31], [165, 32], [164, 32], [163, 33], [162, 33], [161, 34], [160, 34], [160, 35], [159, 36], [158, 36], [158, 39], [157, 40], [156, 39], [156, 40], [155, 41], [154, 41], [153, 42], [152, 42], [152, 43], [151, 44], [150, 44], [150, 45], [149, 46], [148, 46], [148, 48], [147, 49], [144, 49], [144, 50], [143, 51], [142, 50], [142, 51], [141, 52], [140, 52], [140, 53], [139, 54], [138, 54], [137, 55], [136, 54], [135, 55], [134, 55], [134, 57], [133, 58], [132, 57], [131, 57], [130, 58], [129, 57], [128, 57], [127, 58], [126, 58], [125, 57], [124, 58], [123, 57], [123, 56], [121, 54], [121, 46], [120, 46], [119, 45], [119, 43], [120, 42], [119, 41], [119, 38], [120, 37], [120, 36], [119, 35], [119, 28], [118, 28], [117, 27], [118, 26], [120, 26], [120, 24], [119, 23], [119, 13], [118, 13], [117, 12], [117, 10], [116, 10], [115, 9], [115, 8], [114, 8], [113, 7], [113, 6], [112, 5], [111, 5], [108, 2], [107, 2], [106, 1], [105, 2], [103, 0], [102, 1], [101, 1], [100, 0], [99, 1], [97, 1]])
                    , np.matrix([[89,0],[89,1],[88,2],[87,1],[86,2],[85,1],[82,1],[82,2],[81,3],[79,3],[78,4],[77,4],[75,6],[74,6],[71,9],[70,8],[69,8],[68,7],[67,7],[66,6],[67,5],[66,4],[65,4],[66,4],[67,5],[66,6],[64,6],[63,5],[62,5],[61,4],[59,4],[58,5],[57,5],[57,6],[56,7],[55,7],[54,8],[53,8],[52,9],[51,9],[49,11],[49,12],[46,15],[45,15],[46,16],[46,17],[45,18],[44,17],[41,17],[40,16],[40,15],[39,15],[38,16],[37,16],[36,17],[35,17],[34,18],[33,18],[31,20],[30,20],[28,22],[28,23],[25,26],[24,25],[23,25],[22,26],[21,26],[20,25],[20,23],[19,24],[17,24],[16,23],[14,23],[13,22],[13,23],[11,25],[10,25],[9,26],[8,26],[6,28],[6,29],[5,30],[5,31],[3,33],[3,35],[2,36],[1,35],[0,35],[1,36],[1,37],[2,37],[3,38],[2,39],[1,39],[1,41],[2,42],[2,44],[1,45],[2,46],[2,49],[1,50],[2,51],[2,52],[1,53],[1,57],[5,61],[5,66],[6,65],[7,66],[7,68],[8,69],[8,74],[7,75],[7,78],[7,77],[8,76],[9,77],[9,79],[10,80],[10,82],[11,83],[11,88],[13,90],[13,93],[15,95],[15,98],[16,98],[17,99],[17,100],[18,101],[18,102],[17,103],[17,104],[18,104],[19,105],[18,106],[17,106],[18,107],[18,109],[19,110],[19,114],[18,115],[19,115],[20,116],[19,117],[19,121],[20,122],[20,125],[19,126],[19,130],[17,132],[18,132],[19,133],[17,135],[18,136],[18,137],[17,138],[17,141],[16,142],[15,141],[15,148],[14,149],[13,148],[12,149],[11,149],[11,150],[12,149],[13,150],[13,153],[12,154],[11,154],[11,155],[12,155],[13,156],[13,157],[11,159],[11,161],[10,162],[9,162],[9,164],[8,165],[78,165],[78,162],[79,161],[80,161],[80,160],[79,159],[80,158],[80,153],[81,152],[82,152],[82,148],[83,147],[83,145],[84,144],[84,143],[86,141],[86,139],[89,136],[89,135],[90,134],[89,133],[89,132],[90,131],[90,128],[92,126],[92,124],[93,123],[93,122],[96,119],[96,118],[97,117],[98,117],[98,116],[99,115],[100,115],[100,112],[101,111],[102,111],[103,110],[103,109],[104,108],[106,108],[105,107],[106,106],[107,106],[107,105],[108,104],[109,104],[109,103],[111,101],[113,101],[114,100],[114,99],[115,98],[116,98],[116,97],[117,96],[120,96],[119,96],[118,95],[120,93],[121,93],[121,92],[122,91],[123,91],[126,88],[128,88],[128,86],[130,84],[131,85],[131,87],[132,87],[132,86],[131,85],[133,83],[134,83],[135,82],[136,82],[136,81],[138,79],[139,80],[139,77],[140,76],[140,75],[141,74],[141,72],[142,71],[143,71],[145,69],[145,67],[146,66],[147,66],[148,65],[148,64],[149,63],[150,63],[150,62],[151,61],[152,61],[152,60],[156,56],[155,55],[156,54],[158,54],[161,51],[162,51],[162,50],[163,49],[163,47],[164,46],[165,47],[165,45],[166,44],[168,44],[168,43],[167,42],[168,41],[168,39],[170,37],[170,36],[171,35],[172,35],[172,33],[173,32],[174,32],[176,34],[176,35],[176,30],[177,29],[178,30],[179,30],[181,28],[181,26],[180,25],[180,24],[179,24],[178,23],[177,23],[174,20],[174,17],[171,17],[170,16],[164,16],[163,17],[162,16],[161,17],[161,18],[160,19],[157,19],[154,22],[152,22],[151,23],[150,23],[149,22],[149,23],[146,26],[144,26],[142,28],[141,28],[141,29],[140,30],[139,29],[139,31],[138,32],[136,32],[134,34],[135,35],[134,36],[133,36],[133,37],[132,38],[131,38],[131,39],[129,41],[128,41],[126,43],[125,43],[125,45],[124,46],[123,45],[123,44],[121,44],[121,45],[120,46],[118,46],[117,47],[116,46],[115,46],[114,45],[113,45],[114,46],[113,47],[112,47],[111,46],[111,45],[109,43],[109,42],[107,40],[107,39],[108,38],[109,38],[108,38],[107,39],[106,38],[106,37],[107,36],[108,36],[106,34],[107,35],[107,36],[106,37],[105,37],[104,36],[104,34],[102,32],[102,31],[103,30],[104,30],[103,29],[102,29],[101,28],[102,27],[103,27],[103,26],[104,25],[104,18],[103,17],[103,15],[102,14],[101,14],[100,13],[100,12],[101,11],[100,12],[94,6],[94,5],[92,5],[90,3],[91,2],[92,2],[91,2]])
                    , np.matrix([[133,0],[132,1],[133,0],[134,1],[134,2],[133,3],[131,3],[130,2],[130,1],[129,2],[126,2],[125,3],[124,3],[124,5],[122,7],[121,7],[120,6],[118,6],[117,7],[116,7],[116,8],[115,9],[114,9],[113,8],[113,7],[112,8],[111,7],[111,6],[110,6],[109,5],[108,5],[108,6],[107,7],[106,6],[105,6],[104,7],[104,8],[103,9],[102,8],[101,8],[100,9],[99,9],[98,10],[98,11],[95,14],[94,14],[93,15],[92,14],[92,17],[91,18],[90,17],[90,20],[89,21],[88,20],[88,19],[87,18],[86,18],[85,19],[84,19],[83,18],[82,19],[80,19],[76,23],[76,24],[75,25],[72,25],[71,26],[70,26],[70,28],[69,29],[68,28],[67,28],[66,29],[65,29],[63,27],[62,27],[61,28],[60,27],[59,27],[59,28],[58,29],[57,29],[56,30],[55,30],[55,31],[54,32],[55,32],[56,33],[56,34],[59,34],[63,38],[60,41],[59,41],[58,40],[58,38],[56,36],[55,37],[54,37],[53,36],[53,34],[52,34],[52,35],[51,36],[50,36],[50,37],[49,38],[48,38],[48,40],[47,41],[46,41],[46,45],[45,46],[44,46],[44,52],[43,53],[42,53],[42,55],[44,57],[44,61],[45,61],[46,62],[46,63],[47,63],[48,64],[48,67],[49,67],[50,68],[50,78],[52,80],[51,81],[50,81],[50,82],[51,82],[52,83],[52,84],[51,85],[50,85],[52,85],[53,86],[52,87],[54,89],[54,93],[55,93],[56,94],[56,97],[57,97],[58,98],[58,103],[59,103],[60,104],[60,106],[59,107],[58,107],[58,109],[59,109],[60,110],[60,111],[59,112],[59,113],[60,114],[60,121],[61,122],[61,124],[62,125],[62,139],[61,140],[60,140],[60,148],[59,149],[58,149],[58,156],[57,157],[56,157],[56,158],[57,159],[56,160],[55,160],[54,159],[54,166],[53,167],[52,167],[52,168],[53,169],[53,170],[52,171],[52,172],[51,173],[50,172],[50,173],[51,173],[52,174],[52,175],[51,176],[50,176],[50,177],[48,179],[48,182],[49,182],[50,183],[50,184],[49,185],[48,185],[48,188],[47,189],[46,188],[44,190],[44,192],[43,193],[42,193],[42,196],[43,197],[42,198],[41,198],[41,199],[40,200],[40,203],[38,205],[38,206],[39,207],[38,208],[39,209],[38,210],[37,210],[38,211],[37,212],[36,212],[36,216],[35,217],[36,218],[36,221],[35,222],[34,222],[34,226],[31,229],[32,230],[32,232],[31,233],[31,236],[30,237],[28,237],[28,238],[27,239],[28,238],[29,238],[30,239],[29,240],[29,242],[26,245],[26,249],[24,251],[24,252],[25,253],[24,254],[23,254],[21,256],[22,255],[23,255],[24,256],[23,257],[23,260],[21,262],[20,262],[20,264],[21,265],[19,267],[20,268],[19,269],[19,274],[18,275],[18,277],[17,278],[16,278],[16,287],[14,289],[14,292],[13,293],[12,293],[13,294],[13,296],[12,297],[12,299],[10,301],[11,302],[11,303],[10,304],[11,305],[10,306],[10,307],[9,308],[8,308],[8,310],[9,311],[8,312],[7,312],[7,313],[8,314],[8,317],[7,318],[7,320],[6,321],[7,322],[7,325],[6,326],[6,327],[5,328],[4,328],[4,330],[5,330],[6,331],[5,332],[5,335],[4,336],[5,337],[4,338],[5,339],[3,341],[2,340],[2,343],[3,343],[4,344],[4,348],[2,350],[3,351],[3,355],[2,356],[2,363],[1,364],[0,364],[0,366],[1,367],[1,368],[22,368],[20,368],[19,367],[21,365],[22,365],[23,366],[24,365],[25,365],[26,366],[25,367],[25,368],[27,368],[27,366],[28,365],[29,366],[29,367],[30,368],[33,368],[34,367],[35,367],[36,368],[49,368],[50,367],[51,368],[52,367],[53,368],[93,368],[95,366],[96,367],[96,368],[104,368],[104,364],[105,363],[104,362],[105,361],[105,358],[107,356],[106,355],[106,354],[105,353],[105,350],[106,349],[107,350],[107,351],[108,350],[109,351],[110,350],[111,350],[111,348],[111,349],[109,351],[108,350],[108,348],[107,347],[107,345],[109,343],[110,344],[110,343],[109,342],[109,341],[110,340],[110,338],[109,337],[111,335],[112,335],[111,335],[110,334],[110,328],[108,326],[108,325],[109,324],[110,325],[111,325],[111,324],[110,324],[109,323],[110,322],[109,323],[108,323],[107,322],[107,320],[108,319],[108,318],[107,317],[107,315],[109,313],[111,313],[111,312],[109,312],[108,311],[110,309],[109,308],[111,306],[113,306],[112,306],[111,305],[112,304],[111,303],[112,302],[112,299],[111,298],[111,297],[112,296],[112,293],[113,292],[112,291],[113,290],[113,288],[112,288],[112,290],[111,291],[110,290],[110,287],[111,286],[112,286],[112,285],[113,284],[112,283],[112,280],[113,279],[113,278],[112,277],[113,276],[114,276],[113,275],[113,271],[113,273],[112,274],[111,273],[111,269],[112,268],[114,268],[114,261],[115,260],[114,259],[114,257],[115,256],[115,255],[116,254],[115,253],[115,249],[116,248],[114,248],[113,247],[114,246],[114,245],[115,244],[116,244],[116,242],[116,243],[115,244],[114,243],[114,239],[115,238],[116,239],[116,240],[116,238],[115,238],[114,237],[115,236],[118,236],[118,234],[117,233],[118,232],[118,229],[119,228],[119,224],[118,224],[117,223],[117,222],[118,221],[119,221],[119,217],[120,216],[121,216],[121,215],[122,214],[121,213],[122,212],[121,211],[121,205],[123,203],[123,200],[122,201],[121,200],[121,197],[122,196],[123,197],[123,198],[123,197],[124,196],[124,195],[125,194],[125,192],[124,191],[125,190],[124,189],[125,188],[125,182],[126,181],[126,180],[127,179],[127,177],[127,178],[126,179],[125,178],[125,175],[126,174],[125,173],[125,170],[126,169],[126,167],[127,166],[128,167],[128,168],[129,168],[129,167],[130,166],[129,167],[128,167],[127,166],[127,164],[129,162],[128,161],[128,160],[129,159],[131,161],[129,159],[130,158],[130,157],[129,156],[129,152],[130,151],[130,150],[131,149],[132,150],[132,151],[133,150],[133,149],[132,149],[131,148],[131,143],[133,141],[133,138],[134,137],[135,137],[134,136],[135,135],[135,132],[136,131],[137,131],[135,129],[136,128],[137,128],[137,126],[138,125],[138,124],[139,123],[139,122],[141,120],[142,120],[143,119],[143,118],[144,117],[144,116],[145,115],[146,115],[147,114],[148,115],[148,114],[149,113],[149,112],[153,108],[154,108],[155,107],[156,107],[156,106],[160,102],[161,102],[164,99],[165,99],[167,97],[169,97],[169,96],[170,95],[171,95],[173,93],[175,93],[175,92],[176,91],[177,91],[176,90],[177,89],[178,89],[179,88],[180,88],[184,84],[185,84],[185,83],[186,82],[187,83],[187,80],[189,78],[189,76],[191,74],[191,72],[192,71],[193,71],[193,69],[194,68],[195,68],[195,67],[198,64],[199,64],[199,62],[200,61],[201,61],[201,60],[202,59],[203,60],[202,59],[204,57],[204,56],[206,54],[207,54],[207,53],[208,52],[209,52],[210,53],[209,52],[212,49],[213,49],[213,47],[215,45],[215,44],[216,43],[217,43],[217,40],[219,38],[219,37],[229,27],[230,28],[230,27],[233,24],[233,22],[234,21],[234,20],[232,18],[231,18],[229,16],[229,15],[226,15],[225,14],[224,14],[223,15],[221,15],[219,13],[218,13],[218,15],[217,16],[215,16],[214,15],[213,16],[213,17],[212,18],[210,18],[209,17],[208,17],[208,18],[206,20],[203,20],[201,22],[200,22],[198,24],[198,25],[197,26],[196,26],[196,27],[195,28],[192,28],[192,30],[191,31],[190,31],[190,32],[189,33],[188,32],[188,31],[188,35],[187,36],[186,35],[186,37],[185,38],[184,38],[184,40],[183,41],[182,41],[182,42],[181,43],[178,43],[178,44],[177,45],[177,46],[175,48],[174,47],[174,49],[173,50],[172,49],[172,50],[171,51],[170,51],[170,52],[169,53],[168,52],[168,51],[167,51],[165,49],[164,49],[163,48],[164,47],[165,47],[164,47],[162,45],[162,44],[159,41],[159,39],[158,39],[157,38],[157,34],[156,34],[155,33],[155,31],[154,31],[153,30],[153,26],[152,26],[151,25],[151,14],[150,14],[149,13],[149,9],[148,8],[146,8],[145,7],[145,6],[144,6],[143,5],[143,4],[142,4],[141,3],[137,3],[135,1],[134,1]])
                    ]

five_fingers_hull = [ np.matrix([[211,102],[2,96],[0,89],[0,85],[44,29],[80,0],[85,0],[127,4],[131,5],[133,7],[209,93],[211,96]])
                    , np.matrix([[249,137],[0,114],[0,105],[54,32],[105,0],[113,0],[157,7],[162,8],[165,9],[249,128]])
                    , np.matrix([[196,99],[180,161],[0,87],[0,83],[1,80],[3,76],[41,28],[42,27],[77,0],[84,0],[122,4],[124,5],[194,91],[196,94]])
                    ]
fist_with_finger_hull = [ np.matrix([[203,30],[0,72],[0,66],[2,48],[3,44],[4,41],[6,38],[12,32],[58,8],[62,6],[90,0],[94,0],[101,1],[191,21],[195,22],[203,25]])
                        , np.matrix([[190,34],[186,46],[0,58],[0,50],[3,41],[8,31],[10,28],[16,22],[72,3],[76,2],[106,0],[109,0],[117,1],[177,11],[179,12],[189,28],[190,30]])
                        , np.matrix([[227,46],[226,49],[4,71],[8,50],[10,45],[14,40],[15,39],[22,34],[68,10],[74,7],[101,0],[220,35],[224,37],[227,39]])
                        ]
surfer_thing_hull = [ np.matrix([[175,26],[0,14],[0,4],[5,0],[9,0],[167,18],[173,20],[175,22]])
                    , np.matrix([[229,58],[228,60],[11,25],[12,16],[15,4],[16,1],[20,0],[27,0],[218,46],[223,48],[229,54]])
                    , np.matrix([[212,32],[11,65],[2,32],[0,22],[0,13],[1,10],[4,3],[6,0],[11,0],[211,28],[212,31]])
                    ]

five_fingers_shape = HandShape(five_fingers, 'Five Fingers')
fist_with_finger_shape = HandShape(fist_with_finger, 'Pointing')

five_fingers_shape_hull = HandShape(five_fingers_hull, 'Five Fingers')
fist_with_finger_shape_hull = HandShape(fist_with_finger_hull, 'Pointing')
surfer_thing_shape_hull = HandShape(surfer_thing_hull, 'Thumb and small finger')

if use_hull:
    shapes = [five_fingers_shape_hull, fist_with_finger_shape_hull, surfer_thing_shape_hull]
else:
    shapes = [five_fingers_shape, fist_with_finger_shape]

minimal_count = 5000
DEBUG = False


class GestureHandler:
    def __init__(self, cam_num):
        self.cam_num = cam_num

        self.x_center, self.y_center = None, None
        self.x_counter, self.y_counter = 0, 0
        global shapes
        global use_hull
        global DEBUG
        self.last_contour = None
        self.cap = cv2.VideoCapture(self.cam_num)
        self.fgbg = cv2.createBackgroundSubtractorMOG2(history=500, varThreshold=16, detectShadows=False)

    def get_contour(self):
        return self.last_contour

    def reset_history(self):
        self.fgbg = cv2.createBackgroundSubtractorMOG2(history=500, varThreshold=16, detectShadows=False)

    def update(self):
        ret, img = self.cap.read()

        preprocessed = None

        if color_keying:
            hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)
            mask = cv2.inRange(hsv, (4, 15, 100), (70, 170, 255))
            hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)
            mask2 = cv2.inRange(hsv, (140, 0, 50), (165, 160, 255))

            if show_detailed:
                cv2.imshow("1", mask)
                cv2.imshow("2", mask2)

            imask = mask + mask2 > 0
            skin = np.zeros_like(img, np.uint8)
            skin[imask] = img[imask]
            preprocessed = skin
        else:
            preprocessed = img

        fg_mask = self.fgbg.apply(preprocessed)

        whites_count = cv2.countNonZero(fg_mask)

        blur = cv2.GaussianBlur(fg_mask, (11, 11), 0)
        _, gaussian = cv2.threshold(blur, 70, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)

        if show_detailed:
            cv2.imshow("gaussian", gaussian)

        contours, hierarchy = cv2.findContours(fg_mask, cv2.RETR_TREE, cv2.CHAIN_APPROX_SIMPLE)

        max_area = 0
        ci = None
        for i in range(len(contours)):
            cnt = contours[i]
            area = cv2.contourArea(cnt)
            if area > max_area:
                max_area = area
                ci = i
        if ci is not None:
            cnt = contours[ci]

        hull = cv2.convexHull(cnt)

        x, y, w, h = cv2.boundingRect(cnt)

        cropped_gaussian = gaussian[y:y + h, x:x + w]
        if show_detailed:
            cv2.imshow("crop", cropped_gaussian)

        drawing = np.zeros(img.shape, np.uint8)
        if whites_count > minimal_count:
            cv2.drawContours(drawing, [cnt], 0, (0, 255, 0), 2)
            cv2.drawContours(drawing, [hull], 0, (0, 0, 255), 2)
            cv2.drawContours(img, [cnt], 0, (0, 255, 0), 2)
            cv2.drawContours(img, [hull], 0, (0, 0, 255), 2)
        if DEBUG:
            cv2.drawContours(img, [surfer_thing_shape_hull.shape[0]], 0, (255, 0, 255), 2)

        x_previous = self.x_center
        y_previous = self.y_center

        self.x_center = 0
        self.y_center = 0
        for i in hull:
            self.x_center += i[0][0]
            self.y_center += i[0][1]

        self.x_center /= len(hull)
        self.y_center /= len(hull)

        if x_previous is not None and y_previous is not None and whites_count > minimal_count:
            x_delta = (self.x_center - x_previous)
            y_delta = (self.y_center - y_previous)
        else:
            for s in shapes:
                s.reset_count()
            x_delta = 0
            y_delta = 0

        if whites_count < minimal_count:
            for s in shapes:
                s.reset_count()
            self.x_counter = 0
            self.y_counter = 0
        else:
            self.x_counter += x_delta
            self.y_counter += y_delta

        hull = cv2.convexHull(cnt)

        if whites_count > minimal_count and x_previous is not None and y_previous is not None:
            cv2.drawMarker(drawing, (int(self.x_center), int(self.y_center)), (255, 0, 255))
            cv2.drawMarker(drawing, (int(x_previous), int(y_previous)), (255, 255, 255))
            cv2.drawMarker(img, (int(self.x_center), int(self.y_center)), (255, 0, 255))
            cv2.drawMarker(img, (int(x_previous), int(y_previous)), (255, 255, 255))

        contour_gaussian_cropped = np.matrix(list(map(lambda a: [a[0][0] - x, a[0][1] - y], cnt)))
        self.last_contour = cv2.convexHull(contour_gaussian_cropped)

        if use_hull:
            contour_gaussian_cropped = cv2.convexHull(contour_gaussian_cropped)
            m = max(list(map(lambda x: x[0][1], contour_gaussian_cropped)))
            c = list(filter(lambda y: abs(y[0][1]-m) > 40, contour_gaussian_cropped))
            c = list(map(lambda x: list(x[0]), c))
            c = np.array(c)
            contour_gaussian_cropped = c
            if DEBUG and c.shape[0] != 0:
                cv2.drawContours(img, [contour_gaussian_cropped], 0, (255, 0, 255), 2)

        rets = [x.bestMatch(contour_gaussian_cropped) for x in shapes]
        m_ret = 1
        m_sh = None
        message = None
        for i, sh in zip(rets, shapes):
            if m_ret > i:
                m_ret = i
                m_sh = sh

        if whites_count > minimal_count and m_ret < 0.15:
            m_sh.inc_count()

        if self.x_counter > 400:
            tmp_m_sh = None
            tmp_m_count = -1
            for s in shapes:
                if tmp_m_count < s.count:
                    tmp_m_count = s.count
                    tmp_m_sh = s
            if tmp_m_sh.count > 5:
                message = tmp_m_sh.msg + ' left ' + str(tmp_m_sh.count)

        if self.x_counter < -400:
            tmp_m_sh = None
            tmp_m_count = -1
            for s in shapes:
                if tmp_m_count < s.count:
                    tmp_m_count = s.count
                    tmp_m_sh = s
            if tmp_m_sh.count > 5:
                message = tmp_m_sh.msg + ' right ' + str(tmp_m_sh.count)

        if color_keying:
            cv2.imshow('skin', skin)

        if show_detailed:
            cv2.imshow('fg_mask', fg_mask)
            cv2.imshow('drawing', drawing)

        return cv2.cvtColor(img, cv2.COLOR_BGR2RGB), message
